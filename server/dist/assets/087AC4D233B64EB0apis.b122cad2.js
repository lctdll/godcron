/*! 
 Build based on gin-vue-admin 
 Time : 1718874130000 */
import{v as e,a,T as t,o as s,c as o,b as l,d as r,w as p,g as i,t as n,j as u,l as d,E as c}from"./087AC4D233B64EB0index.f7794d3b.js";import{E as h}from"./087AC4D233B64EB0scrollbar.5ea68434.js";import{E as m}from"./087AC4D233B64EB0tree.c14f07f4.js";import"./087AC4D233B64EB0checkbox.689d67cf.js";/* empty css                                *//* empty css                               *//* empty css                               *//* empty css                              */import{e as f}from"./087AC4D233B64EB0api.8afb9e32.js";import{E as v}from"./087AC4D233B64EB0index.180a68c4.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0index.9bb18579.js";import"./087AC4D233B64EB0isEqual.e4d5ab49.js";import"./087AC4D233B64EB0_Uint8Array.a14e9c36.js";const B={class:"sticky top-0.5 z-10 flex space-x-2"},y={class:"tree-content"},E={class:"flex items-center justify-between w-full pr-1"},j={class:"max-w-[240px] break-all overflow-ellipsis overflow-hidden"},A=Object.assign({name:"Apis"},{__name:"apis",props:{row:{default:function(){return{}},type:Object}},setup(A,{expose:C}){const b=A,x=a({children:"children",label:"description"}),k=a(""),D=a(""),w=a([]),g=a([]),I=a("");(async()=>{const a=(await f()).data.apis;w.value=O(a);const t=await(s={authorityId:b.row.authorityId},e({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;I.value=b.row.authorityId,g.value=[],t.data.paths&&t.data.paths.forEach((e=>{g.value.push("p:"+e.path+"m:"+e.method)}))})();const _=a(!1),V=()=>{_.value=!0},O=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},P=a(null),U=async()=>{const a=P.value.getCheckedNodes(!0);var t=[];a&&a.forEach((e=>{var a={path:e.path,method:e.method};t.push(a)}));var s;0===(await(s={authorityId:I.value,casbinInfos:t},e({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&u({type:"success",message:"api设置成功"})};C({needConfirm:_,enterAndNext:()=>{U()}});const G=(e,a)=>{if(!k.value&&!D.value)return!0;let t,s;return t=!k.value||a.description&&a.description.includes(k.value),s=!D.value||a.path&&a.path.includes(D.value),t&&s};return t([k,D],(()=>{P.value.filter("")})),(e,a)=>{const t=d,u=c,f=v,A=m,C=h;return s(),o("div",null,[l("div",B,[r(t,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value=e),class:"flex-1",placeholder:"筛选名字"},null,8,["modelValue"]),r(t,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e),class:"flex-1",placeholder:"筛选路径"},null,8,["modelValue"]),r(u,{class:"float-right",type:"primary",onClick:U},{default:p((()=>[i("确 定")])),_:1})]),l("div",y,[r(C,null,{default:p((()=>[r(A,{ref_key:"apiTree",ref:P,data:w.value,"default-checked-keys":g.value,props:x.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":G,onCheck:V},{default:p((({node:e,data:a})=>[l("div",E,[l("span",null,n(a.description),1),r(f,{content:a.path},{default:p((()=>[l("span",j,n(a.path),1)])),_:2},1032,["content"])])])),_:1},8,["data","default-checked-keys","props"])])),_:1})])])}}});export{A as default};
