/*! 
 Build based on gin-vue-admin 
 Time : 1718874130000 */
import{a,o as e,c as t,d as l,b as o,w as r,g as i,G as u,ay as d,h as s,e as n,au as m,j as p,E as y,J as h,l as c}from"./087AC4D233B64EB0index.f7794d3b.js";import{E as v}from"./087AC4D233B64EB0drawer.178042b4.js";import"./087AC4D233B64EB0overlay.ee491930.js";import{E as B,a as f}from"./087AC4D233B64EB0tab-pane.03f159a3.js";import{E as C}from"./087AC4D233B64EB0dialog.eb147687.js";import{a as E,E as A}from"./087AC4D233B64EB0form-item.2294f669.js";/* empty css                              */import{E as I}from"./087AC4D233B64EB0radio.33d77285.js";/* empty css                               *//* empty css                            */import"./087AC4D233B64EB0checkbox.689d67cf.js";import"./087AC4D233B64EB0scrollbar.5ea68434.js";import{E as b,a as D}from"./087AC4D233B64EB0table-column.ebf38335.js";/* empty css                                *//* empty css                               */import{g as j,d as g,c as w,u as _,a as k}from"./087AC4D233B64EB0authority.52031b93.js";import N from"./087AC4D233B64EB0menus.f61dbc55.js";import V from"./087AC4D233B64EB0apis.b122cad2.js";import x from"./087AC4D233B64EB0datas.b5551548.js";import{_ as U}from"./087AC4D233B64EB0warningBar.4245c872.js";import{t as q}from"./087AC4D233B64EB0doc.46160848.js";import"./087AC4D233B64EB0index.180a68c4.js";import"./087AC4D233B64EB0strings.13f65845.js";import"./087AC4D233B64EB0index.7226ef52.js";import"./087AC4D233B64EB0castArray.b2df96d4.js";import"./087AC4D233B64EB0_baseClone.3d27a61c.js";import"./087AC4D233B64EB0_Uint8Array.a14e9c36.js";import"./087AC4D233B64EB0_initCloneObject.6c0ecbc8.js";import"./087AC4D233B64EB0isEqual.e4d5ab49.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";import"./087AC4D233B64EB0cloneDeep.7b114e0a.js";import"./087AC4D233B64EB0index.18ebb74e.js";import"./087AC4D233B64EB0index.21f2f826.js";import"./087AC4D233B64EB0debounce.9b1e718d.js";import"./087AC4D233B64EB0_baseIteratee.ecc9a1d9.js";import"./087AC4D233B64EB0tree.c14f07f4.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0index.9bb18579.js";import"./087AC4D233B64EB0authorityBtn.1d772888.js";import"./087AC4D233B64EB0api.8afb9e32.js";const z={class:"authority"},R={class:"gva-table-box"},S={class:"gva-btn-list"},T={class:"dialog-footer"},F=Object.assign({name:"Authority"},{__name:"authority",setup(F){const G=a([{authorityId:0,authorityName:"根角色"}]),K=a(!1),L=a("add"),O=a({}),P=a("新增角色"),J=a(!1),M=a(!1),$=a({}),H=a({authorityId:0,authorityName:"",parentId:0}),Q=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),W=a(1),X=a(0),Y=a(999),Z=a([]),aa=a({}),ea=async()=>{const a=await j({page:W.value,pageSize:Y.value,...aa.value});0===a.code&&(Z.value=a.data.list,X.value=a.data.total,W.value=a.data.page,Y.value=a.data.pageSize)};ea();const ta=(a,e)=>{O.value[a]=e},la=a(null),oa=a(null),ra=a(null),ia=(a,e)=>{const t=[la,oa,ra];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},ua=a(null),da=()=>{ua.value&&ua.value.resetFields(),H.value={authorityId:0,authorityName:"",parentId:0}},sa=()=>{da(),J.value=!1,M.value=!1},na=()=>{ua.value.validate((async a=>{if(a){switch(H.value.authorityId=Number(H.value.authorityId),L.value){case"add":0===(await k(H.value)).code&&(p({type:"success",message:"添加成功!"}),ea(),sa());break;case"edit":0===(await _(H.value)).code&&(p({type:"success",message:"添加成功!"}),ea(),sa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=H.value.authorityId,a.authority.authorityName=H.value.authorityName,a.authority.parentId=H.value.parentId,a.authority.dataAuthorityId=$.value.dataAuthorityId,a.oldAuthorityId=$.value.authorityId;0===(await w(a)).code&&(p({type:"success",message:"复制成功！"}),ea())}}da(),J.value=!1}}))},ma=()=>{G.value=[{authorityId:0,authorityName:"根角色"}],pa(Z.value,G.value,!1)},pa=(a,e,t)=>{a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===H.value.authorityId,children:[]};pa(a.children,l.children,t||a.authorityId===H.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===H.value.authorityId};e.push(l)}}))},ya=a=>{da(),P.value="新增角色",L.value="add",H.value.parentId=a,ma(),J.value=!0};return(a,j)=>{const w=y,_=h,k=b,F=D,M=I,X=E,Y=c,aa=A,da=C,pa=B,ha=f,ca=v;return e(),t("div",z,[l(U,{title:"注：右上角头像下拉可切换角色"}),o("div",R,[o("div",S,[l(w,{type:"primary",icon:"plus",onClick:j[0]||(j[0]=a=>ya(0))},{default:r((()=>[i("新增角色")])),_:1}),l(_,{class:"cursor-pointer",onClick:j[1]||(j[1]=a=>u(q)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=8&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:r((()=>[l(u(d))])),_:1})]),l(F,{data:Z.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(k,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(k,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(k,{align:"left",label:"操作",width:"460"},{default:r((a=>[l(w,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,K.value=!0,void(O.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(w,{icon:"plus",type:"primary",link:"",onClick:e=>ya(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(w,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{ma(),P.value="拷贝角色",L.value="copy";for(const e in H.value)H.value[e]=a[e];$.value=a,J.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(w,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{ma(),P.value="编辑角色",L.value="edit";for(const e in H.value)H.value[e]=a[e];ma(),J.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(w,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void m.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await g({authorityId:t.authorityId})).code&&(p({type:"success",message:"删除成功!"}),1===Z.value.length&&W.value>1&&W.value--,ea())})).catch((()=>{p({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(da,{modelValue:J.value,"onUpdate:modelValue":j[5]||(j[5]=a=>J.value=a),title:P.value},{footer:r((()=>[o("div",T,[l(w,{onClick:sa},{default:r((()=>[i("取 消")])),_:1}),l(w,{type:"primary",onClick:na},{default:r((()=>[i("确 定")])),_:1})])])),default:r((()=>[l(aa,{ref_key:"authorityForm",ref:ua,model:H.value,rules:Q.value,"label-width":"80px"},{default:r((()=>[l(X,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(M,{modelValue:H.value.parentId,"onUpdate:modelValue":j[2]||(j[2]=a=>H.value.parentId=a),style:{width:"100%"},disabled:"add"===L.value,options:G.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(X,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(Y,{modelValue:H.value.authorityId,"onUpdate:modelValue":j[3]||(j[3]=a=>H.value.authorityId=a),disabled:"edit"===L.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(X,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(Y,{modelValue:H.value.authorityName,"onUpdate:modelValue":j[4]||(j[4]=a=>H.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),K.value?(e(),s(ca,{key:0,modelValue:K.value,"onUpdate:modelValue":j[6]||(j[6]=a=>K.value=a),"with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(ha,{"before-leave":ia,type:"border-card"},{default:r((()=>[l(pa,{label:"角色菜单"},{default:r((()=>[l(N,{ref_key:"menus",ref:la,row:O.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(pa,{label:"角色api"},{default:r((()=>[l(V,{ref_key:"apis",ref:oa,row:O.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(pa,{label:"资源权限"},{default:r((()=>[l(x,{ref_key:"datas",ref:ra,authority:Z.value,row:O.value,onChangeRow:ta},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):n("",!0)])}}});export{F as default};
